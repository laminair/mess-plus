import numpy as np
import pandas as pd

from typing import List, Dict

def exploit(
        classifier,
        input_text: str,
        energy_history: Dict,
        V: float,
        alpha: float,
        Q_tracked: float,
        label_cols: List[str]
    ):
    preds, probs = classifier.predict(texts=[input_text])

    agg_dict = {}
    for label, value_list in energy_history.items():
        agg_dict[label] = sum(value_list) / len(value_list)

    energy = pd.DataFrame(agg_dict, index=[0]).to_numpy()

    energy = np.array(energy).reshape(-1, 1)
    probs = probs.reshape(-1, 1)

    cost_fn = V * energy + Q_tracked * (alpha - probs)
    cost_fn = cost_fn.reshape(1, -1)
    chosen_model_id = np.argmin(cost_fn)
    model_category_chosen = label_cols[chosen_model_id].replace("label_", "")

    return model_category_chosen
